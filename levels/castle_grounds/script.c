#include <ultra64.h>
#include "sm64.h"
#include "behavior_data.h"
#include "model_ids.h"
#include "seq_ids.h"
#include "segment_symbols.h"
#include "level_commands.h"

#include "game/level_update.h"

#include "levels/scripts.h"

#include "actors/common1.h"

#include "make_const_nonconst.h"
#include "levels/castle_grounds/header.h"

static const LevelScript local_objects_castle_grounds_1_[] = {
OBJECT_WITH_ACTS(0,0,900,-1710,0,180,0,0x0, bhvLaunchDeathWarp,31),
OBJECT_WITH_ACTS(0,-1328,260,4664,0,180,0,0x40000, bhvSpinAirborneCircleWarp,31),
OBJECT_WITH_ACTS(217,6,7102,-4213,0,0,0,0x0, bhvPushableMetalBox,31),
OBJECT_WITH_ACTS(217,6,6784,-4213,0,180,0,0x0, bhvPushableMetalBox,31),
OBJECT_WITH_ACTS(22,6,7409,-4213,0,0,0,0x20000, bhvWarpPipe,31),
OBJECT_WITH_ACTS(0,-3379,-500,-2025,0,180,0,0x80000, bhvLaunchStarCollectWarp,31),
OBJECT_WITH_ACTS(0,5408,4500,3637,0,225,0,0xa0000, bhvAirborneWarp,31),
OBJECT_WITH_ACTS(0,-6901,2376,-6509,0,230,0,0x140000, bhvAirborneWarp,31),
OBJECT_WITH_ACTS(0,4997,-1250,2258,0,210,0,0x1e0000, bhvSwimmingWarp,31),
OBJECT_WITH_ACTS(0,-5812,100,-5937,0,0,0,0x0, bhvWaterfallSoundLoop,31),
OBJECT_WITH_ACTS(0,-7430,1500,873,0,0,0,0x0, bhvBirdsSoundLoop,31),
OBJECT_WITH_ACTS(0,-80,1500,5004,0,0,0,0x10000, bhvBirdsSoundLoop,31),
OBJECT_WITH_ACTS(0,7131,1500,-2989,0,0,0,0x20000, bhvBirdsSoundLoop,31),
OBJECT_WITH_ACTS(217,2366,-62,2000,0,0,0,0x0, bhvPushableMetalBox,31),
OBJECT_WITH_ACTS(54,0,0,0,0,0,0,0x0, bhvMoatGrills,31),
OBJECT_WITH_ACTS(0,0,0,0,0,0,0,0x0, bhvInvisibleObjectsUnderBridge,31),
OBJECT_WITH_ACTS(142,-4878,-787,-5690,0,0,0,0x0, bhvWaterMist2,31),
OBJECT_WITH_ACTS(142,-4996,-787,-5548,0,0,0,0x10000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(142,-5114,-787,-5406,0,0,0,0x20000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(142,-5212,-787,-5219,0,0,0,0x30000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(142,-5311,-787,-5033,0,0,0,0x40000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(142,-5419,-787,-4895,0,0,0,0x50000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(142,-5527,-787,-4757,0,0,0,0x60000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(142,-5686,-787,-4733,0,0,0,0x70000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(142,-5845,-787,-4710,0,0,0,0x80000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(0,5223,-975,1667,0,0,0,0x0, bhvFish2,31),
OBJECT_WITH_ACTS(84,-5069,850,3221,0,0,0,0x10000, bhvBird,31),
OBJECT_WITH_ACTS(84,-4711,742,433,0,0,0,0x10000, bhvBird,31),
OBJECT_WITH_ACTS(84,5774,913,-1114,0,0,0,0x10000, bhvBird,31),
OBJECT_WITH_ACTS(0,-1328,260,4664,0,180,0,0x280000, bhvIntroScene,31),
OBJECT_WITH_ACTS(56,0,0,0,0,0,0,0x0, bhvHiddenAt120Stars,31),
OBJECT_WITH_ACTS(102,11,803,-3015,0,0,0,0x10000, bhvCameraLakitu,31),
OBJECT_WITH_ACTS(55,-3213,3348,-3011,0,0,0,0x0, bhvCastleFlagWaving,31),
OBJECT_WITH_ACTS(55,3213,3348,-3011,0,0,0,0x0, bhvCastleFlagWaving,31),
OBJECT_WITH_ACTS(55,-3835,3348,-6647,0,0,0,0x0, bhvCastleFlagWaving,31),
OBJECT_WITH_ACTS(55,3835,3348,-6647,0,0,0,0x0, bhvCastleFlagWaving,31),
OBJECT_WITH_ACTS(187,-4508,406,4400,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,-4408,406,4500,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,-4708,406,4100,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,-6003,473,-2621,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,-6003,473,-2321,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,6543,461,-617,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,6143,461,-617,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,5773,775,-5722,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,5873,775,-5622,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,5473,775,-5322,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,-1504,326,3196,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,-1204,326,3296,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(85,0,3174,-5625,0,0,0,0x0, bhvYoshi,31),
RETURN()
};
static const LevelScript local_warps_castle_grounds_1_[] = {
WARP_NODE(241,16,1,3,0),
WARP_NODE(0,6,1,0,0),
WARP_NODE(1,6,1,1,0),
WARP_NODE(2,20,1,11,0),
WARP_NODE(3,16,1,3,0),
WARP_NODE(4,16,1,4,0),
WARP_NODE(5,18,1,10,0),
WARP_NODE(6,16,1,6,0),
WARP_NODE(7,16,1,7,0),
WARP_NODE(8,16,1,8,0),
WARP_NODE(10,16,1,10,0),
WARP_NODE(20,16,1,20,0),
WARP_NODE(30,16,1,30,0),
RETURN()
};

static const LevelScript local_objects_castle_grounds_2_[] = {
OBJECT_WITH_ACTS(0,-189,1010,-1576,0,180,0,0x30000, bhvDeathWarp,31),
OBJECT_WITH_ACTS(0,-1338,260,4647,0,180,0,0x40000, bhvSpinAirborneCircleWarp,31),
OBJECT_WITH_ACTS(0,-3389,-815,-2042,0,0,0,0x3c050000, bhvWarp,31),
OBJECT_WITH_ACTS(0,-3379,-500,-2025,0,180,0,0x60000, bhvLaunchDeathWarp,31),
OBJECT_WITH_ACTS(0,-3799,-1199,-5816,0,0,0,0x70000, bhvSwimmingWarp,31),
OBJECT_WITH_ACTS(0,-3379,-500,-2025,0,180,0,0x80000, bhvLaunchStarCollectWarp,31),
OBJECT_WITH_ACTS(0,5408,4500,3637,0,225,0,0xa0000, bhvAirborneWarp,31),
OBJECT_WITH_ACTS(0,-6901,2376,-6509,0,230,0,0x140000, bhvAirborneWarp,31),
OBJECT_WITH_ACTS(0,4997,-1250,2258,0,210,0,0x1e0000, bhvSwimmingWarp,31),
OBJECT_WITH_ACTS(0,-5812,100,-5937,0,0,0,0x0, bhvWaterfallSoundLoop,31),
OBJECT_WITH_ACTS(0,-7430,1500,873,0,0,0,0x0, bhvBirdsSoundLoop,31),
OBJECT_WITH_ACTS(0,-80,1500,5004,0,0,0,0x10000, bhvBirdsSoundLoop,31),
OBJECT_WITH_ACTS(0,7131,1500,-2989,0,0,0,0x20000, bhvBirdsSoundLoop,31),
OBJECT_WITH_ACTS(0,-7430,1500,-5937,0,0,0,0x0, bhvAmbientSounds,31),
OBJECT_WITH_ACTS(54,0,0,0,0,0,0,0x0, bhvMoatGrills,31),
OBJECT_WITH_ACTS(0,0,0,0,0,0,0,0x0, bhvInvisibleObjectsUnderBridge,31),
OBJECT_WITH_ACTS(22,2381,-325,1982,0,0,0,0x0, bhvWarpPipe,31),
OBJECT_WITH_ACTS(142,-4996,-787,-5548,0,0,0,0x10000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(142,-5114,-787,-5406,0,0,0,0x20000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(142,-5212,-787,-5219,0,0,0,0x30000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(142,-5311,-787,-5033,0,0,0,0x40000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(142,-5419,-787,-4895,0,0,0,0x50000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(142,-5527,-787,-4757,0,0,0,0x60000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(142,-5686,-787,-4733,0,0,0,0x70000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(142,-5845,-787,-4710,0,0,0,0x80000, bhvWaterMist2,31),
OBJECT_WITH_ACTS(0,5223,-975,1667,0,0,0,0x0, bhvFish2,31),
OBJECT_WITH_ACTS(84,-5069,850,3221,0,0,0,0x10000, bhvBird,31),
OBJECT_WITH_ACTS(84,-4711,742,433,0,0,0,0x10000, bhvBird,31),
OBJECT_WITH_ACTS(84,5774,913,-1114,0,0,0,0x10000, bhvBird,31),
OBJECT_WITH_ACTS(0,-1328,260,4664,0,180,0,0x280000, bhvIntroScene,31),
OBJECT_WITH_ACTS(56,0,25,0,0,0,0,0x0, bhvHiddenAt120Stars,31),
OBJECT_WITH_ACTS(102,11,803,-3015,0,0,0,0x10000, bhvCameraLakitu,31),
OBJECT_WITH_ACTS(55,-3213,3348,-3011,0,0,0,0x0, bhvCastleFlagWaving,31),
OBJECT_WITH_ACTS(55,3213,3348,-3011,0,0,0,0x0, bhvCastleFlagWaving,31),
OBJECT_WITH_ACTS(55,-3835,3348,-6647,0,0,0,0x0, bhvCastleFlagWaving,31),
OBJECT_WITH_ACTS(55,3835,3348,-6647,0,0,0,0x0, bhvCastleFlagWaving,31),
OBJECT_WITH_ACTS(187,-4508,406,4400,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,-4408,406,4500,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,-4708,406,4100,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,-6003,473,-2621,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,-6003,473,-2321,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,6543,461,-617,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,6143,461,-617,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,5773,775,-5722,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,5873,775,-5622,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,5473,775,-5322,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,-1504,326,3196,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(187,-1204,326,3296,0,0,0,0x0, bhvButterfly,31),
OBJECT_WITH_ACTS(101,781,3330,-5469,0,151,0,0x0, bhvBooInCastle,31),
RETURN()
};
static const LevelScript local_warps_castle_grounds_2_[] = {
WARP_NODE(241,16,2,3,0),
WARP_NODE(0,20,2,10,0),
WARP_NODE(1,6,2,1,0),
WARP_NODE(2,6,4,2,0),
WARP_NODE(3,16,2,3,0),
WARP_NODE(4,16,2,4,0),
WARP_NODE(5,18,2,10,0),
WARP_NODE(6,16,2,6,0),
WARP_NODE(7,16,2,7,0),
WARP_NODE(8,16,2,8,0),
WARP_NODE(10,16,2,10,0),
WARP_NODE(20,16,2,20,0),
WARP_NODE(30,16,2,30,0),
RETURN()
};

const LevelScript level_castle_grounds_entry[] = {
    INIT_LEVEL(),
    LOAD_MIO0(        /*seg*/ 0x07, _castle_grounds_segment_7SegmentRomStart, _castle_grounds_segment_7SegmentRomEnd),
    LOAD_MIO0(        /*seg*/ 0x0A, _water_skybox_mio0SegmentRomStart, _water_skybox_mio0SegmentRomEnd),
    LOAD_MIO0_TEXTURE(/*seg*/ 0x09, _outside_mio0SegmentRomStart, _outside_mio0SegmentRomEnd),
    LOAD_MIO0(        /*seg*/ 0x05, _group10_mio0SegmentRomStart, _group10_mio0SegmentRomEnd),
    LOAD_RAW(         /*seg*/ 0x0C, _group10_geoSegmentRomStart,  _group10_geoSegmentRomEnd),
    LOAD_MIO0(        /*seg*/ 0x06, _group15_mio0SegmentRomStart, _group15_mio0SegmentRomEnd),
    LOAD_RAW(         /*seg*/ 0x0D, _group15_geoSegmentRomStart,  _group15_geoSegmentRomEnd),
    LOAD_MIO0(        /*seg*/ 0x08, _common0_mio0SegmentRomStart, _common0_mio0SegmentRomEnd),
    LOAD_RAW(         /*seg*/ 0x0F, _common0_geoSegmentRomStart,  _common0_geoSegmentRomEnd),
    ALLOC_LEVEL_POOL(),
    MARIO(/*model*/ MODEL_MARIO, /*behParam*/ 0x00000001, /*beh*/ bhvMario),
    JUMP_LINK(script_func_global_1),
    JUMP_LINK(script_func_global_11),
    JUMP_LINK(script_func_global_16),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_03,           castle_grounds_geo_0006F4),
    LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_BUBBLY_TREE,  bubbly_tree_geo),
    LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_WARP_PIPE,    warp_pipe_geo),
    LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_CASTLE_DOOR,  castle_door_geo),
    LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_METAL_DOOR,   metal_door_geo),
    LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_VCUTM_GRILL,  castle_grounds_geo_00070C),
    LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_FLAG,         castle_grounds_geo_000660),
    LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_CANNON_GRILL, castle_grounds_geo_000724),

    AREA(/*index*/ 1, castle_grounds_geo_00073C),
        WARP_NODE(/*id*/ 0xF1, /*destLevel*/ LEVEL_CASTLE_GROUNDS, /*destArea*/ 0x01, /*destNode*/ 0x03, /*flags*/ WARP_NO_CHECKPOINT),
        JUMP_LINK(local_objects_castle_grounds_1_),
        JUMP_LINK(local_warps_castle_grounds_1_),
        TERRAIN(/*terrainData*/ castle_grounds_seg7_collision_level),
        MACRO_OBJECTS(/*objList*/ castle_grounds_seg7_macro_objs),
        SET_BACKGROUND_MUSIC(/*settingsPreset*/ 0x0000, /*seq*/ SEQ_SOUND_PLAYER),
        TERRAIN_TYPE(/*terrainType*/ TERRAIN_GRASS),
    END_AREA(),
	AREA(/*index*/ 2, castle_grounds_geo_00073C),
        WARP_NODE(/*id*/ 0xF1, /*destLevel*/ LEVEL_CASTLE_GROUNDS, /*destArea*/ 0x01, /*destNode*/ 0x03, /*flags*/ WARP_NO_CHECKPOINT),
        JUMP_LINK(local_objects_castle_grounds_2_),
        JUMP_LINK(local_warps_castle_grounds_2_),
        TERRAIN(/*terrainData*/ castle_grounds_seg7_collision_level),
        MACRO_OBJECTS(/*objList*/ castle_grounds_seg7_macro_objs),
        SET_BACKGROUND_MUSIC(/*settingsPreset*/ 0x0000, /*seq*/ SEQ_SOUND_PLAYER),
        TERRAIN_TYPE(/*terrainType*/ TERRAIN_GRASS),
    END_AREA(),

    FREE_LEVEL_POOL(),
    MARIO_POS(/*area*/ 1, /*yaw*/ 180, /*pos*/ -1328, 260, 4664),
    CALL(/*arg*/ 0, /*func*/ lvl_init_or_update),
    CALL_LOOP(/*arg*/ 1, /*func*/ lvl_init_or_update),
    CLEAR_LEVEL(),
    SLEEP_BEFORE_EXIT(/*frames*/ 1),
    EXIT(),
};
